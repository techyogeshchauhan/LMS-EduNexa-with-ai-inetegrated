<!DOCTYPE html>
<html>
<head>
    <title>Quick Token Check</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }
        button {
            background: #00ff00;
            color: #000;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .result {
            background: #000;
            padding: 20px;
            margin: 10px 0;
            border: 1px solid #00ff00;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç Token Checker</h1>
    <button onclick="checkToken()">1. Check Token</button>
    <button onclick="testAPI()">2. Test API</button>
    <button onclick="fixToken()">3. Fix Token</button>
    <div id="result" class="result"></div>

    <script>
        function checkToken() {
            const result = document.getElementById('result');
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            let output = '=== TOKEN CHECK ===\n\n';
            output += `Token exists: ${!!token}\n`;
            output += `Token length: ${token ? token.length : 0}\n`;
            output += `Token starts with eyJ: ${token ? token.startsWith('eyJ') : false}\n\n`;
            
            if (user) {
                const userData = JSON.parse(user);
                output += `User: ${userData.name}\n`;
                output += `Role: ${userData.role}\n`;
                output += `Email: ${userData.email}\n\n`;
            }
            
            if (token) {
                output += `First 50 chars: ${token.substring(0, 50)}...\n`;
                output += `Last 20 chars: ...${token.substring(token.length - 20)}\n`;
            }
            
            result.textContent = output;
        }

        async function testAPI() {
            const result = document.getElementById('result');
            const token = localStorage.getItem('token');
            
            if (!token) {
                result.textContent = '‚ùå No token found!';
                return;
            }
            
            result.textContent = 'Testing API...\n';
            
            try {
                const response = await fetch('http://localhost:5000/api/videos/list?limit=1', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                let output = '=== API TEST ===\n\n';
                output += `Status: ${response.status}\n`;
                output += `Status Text: ${response.statusText}\n\n`;
                
                if (response.ok) {
                    const data = await response.json();
                    output += '‚úÖ API WORKS!\n';
                    output += JSON.stringify(data, null, 2);
                } else {
                    const error = await response.json();
                    output += '‚ùå API FAILED!\n';
                    output += JSON.stringify(error, null, 2);
                }
                
                result.textContent = output;
            } catch (error) {
                result.textContent = `‚ùå Error: ${error.message}`;
            }
        }

        function fixToken() {
            if (confirm('This will clear your token and reload. You will need to login again. Continue?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                alert('‚úÖ Token cleared! Please login again.');
                window.location.href = 'http://localhost:5173';
            }
        }
    </script>
</body>
</html>
